<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Blog-Artikel von Ralf D. Müller über AI, Software-Architektur und Dokumentation">
    <link rel="canonical" href="blog.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Blog | Ralf D. Müller">
    <meta property="og:description" content="Blog-Artikel über AI, Software-Architektur und Dokumentation">
    <meta property="og:image" content="../images/ralf-mueller.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Blog | Ralf D. Müller">
    <meta name="twitter:description" content="Blog-Artikel über AI, Software-Architektur und Dokumentation">
    <meta name="twitter:image" content="../images/ralf-mueller.jpg">
    <title>Blog | Ralf D. Müller</title>
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="../index.html" class="logo">Ralf D. Müller</a>
            <ul class="nav-links">
                <li><a href="../index.html#about">Über mich</a></li>
                <li><a href="../index.html#trainings">Trainings</a></li>
                <li><a href="talks.html">Vorträge</a></li>
                <li><a href="../index.html#publications">Publikationen</a></li>
                <li><a href="blog.html" class="active">Blog</a></li>
                <li><a href="../index.html#contact">Kontakt</a></li>
            </ul>
            <button class="mobile-menu-btn" aria-label="Menü öffnen">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Content -->
    <main class="page-content">
        <div class="container">
            <h1>Blog</h1>
            <p class="page-intro" id="blog-intro">
                Gedanken zu AI, Software-Architektur, Dokumentation und der Zukunft der Softwareentwicklung.
                Ursprünglich auf LinkedIn veröffentlicht.
            </p>

            <!-- Filter Tags -->
            <div class="blog-filters" id="blog-filters">
                <button class="filter-btn active" data-filter="all">Alle</button>
            </div>

            <!-- Blog Posts -->
            <div class="blog-list" id="blog-list">
                <!-- Dynamisch generiert -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; <span class="current-year">2026</span> Ralf D. Müller. Alle Rechte vorbehalten.</p>
            <nav class="footer-nav">
                <a href="impressum.html">Impressum</a>
                <a href="datenschutz.html">Datenschutz</a>
            </nav>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        (function() {
            const months = ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'];
            const blogList = document.getElementById('blog-list');

            function isSafeHttpUrl(url) {
                if (!url || typeof url !== 'string') return false;
                try {
                    const parsed = new URL(url);
                    return parsed.protocol === 'http:' || parsed.protocol === 'https:';
                } catch (e) {
                    return false;
                }
            }

            function isSafeRelativePath(path) {
                return typeof path === 'string' && !path.includes('..') && !path.includes('//') && !path.includes(':');
            }

            fetch('../data/blog.json')
                .then(r => r.json())
                .then(posts => {
                    // Nach Datum sortieren (neueste zuerst)
                    posts.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // Alle Tags sammeln
                    const allTags = new Set();
                    posts.forEach(post => post.tags.forEach(tag => allTags.add(tag)));

                    // Filter-Buttons generieren
                    const filtersContainer = document.getElementById('blog-filters');
                    allTags.forEach(tag => {
                        const btn = document.createElement('button');
                        btn.className = 'filter-btn';
                        btn.setAttribute('data-filter', tag);
                        btn.textContent = tag;
                        filtersContainer.appendChild(btn);
                    });

                    // Blog-Liste generieren
                    function renderPosts(filter = 'all') {
                        blogList.replaceChildren();
                        const filtered = filter === 'all'
                            ? posts
                            : posts.filter(p => p.tags.includes(filter));

                        filtered.forEach(post => {
                            const date = new Date(post.date);
                            const day = String(date.getDate()).padStart(2, '0');
                            const month = months[date.getMonth()];
                            const year = date.getFullYear();

                            const isExternal = isSafeHttpUrl(post.url);
                            const isLocal = typeof post.url === 'string' && !isExternal && isSafeRelativePath(post.url);
                            const safePostUrl = isExternal || isLocal ? post.url : '#';
                            const linkText = isLocal ? 'Artikel lesen →' : 'Auf LinkedIn lesen →';

                            const article = document.createElement('article');
                            article.className = 'blog-item';

                            if (post.icon && isSafeRelativePath(post.icon)) {
                                const icon = document.createElement('div');
                                icon.className = 'blog-icon';
                                const img = document.createElement('img');
                                img.src = `../${post.icon}`;
                                img.alt = '';
                                icon.appendChild(img);
                                article.appendChild(icon);
                            }

                            const dateBox = document.createElement('div');
                            dateBox.className = 'blog-date';

                            const dayEl = document.createElement('span');
                            dayEl.className = 'day';
                            dayEl.textContent = day;
                            const monthEl = document.createElement('span');
                            monthEl.className = 'month';
                            monthEl.textContent = month;
                            const yearEl = document.createElement('span');
                            yearEl.className = 'year';
                            yearEl.textContent = String(year);

                            dateBox.appendChild(dayEl);
                            dateBox.appendChild(monthEl);
                            dateBox.appendChild(yearEl);
                            article.appendChild(dateBox);

                            const content = document.createElement('div');
                            content.className = 'blog-content';

                            const meta = document.createElement('div');
                            meta.className = 'blog-meta';

                            const langBadge = document.createElement('span');
                            langBadge.className = 'lang-badge';
                            langBadge.textContent = post.lang === 'en' ? 'EN' : 'DE';
                            meta.appendChild(langBadge);

                            post.tags.forEach(tag => {
                                const tagEl = document.createElement('span');
                                tagEl.className = 'blog-tag';
                                tagEl.textContent = tag;
                                meta.appendChild(tagEl);
                            });
                            content.appendChild(meta);

                            const h2 = document.createElement('h2');
                            const titleLink = document.createElement('a');
                            titleLink.href = safePostUrl;
                            if (isExternal) {
                                titleLink.target = '_blank';
                                titleLink.rel = 'noopener';
                            }
                            titleLink.textContent = post.title || 'Ohne Titel';
                            h2.appendChild(titleLink);
                            content.appendChild(h2);

                            const excerpt = document.createElement('p');
                            excerpt.textContent = post.excerpt || '';
                            content.appendChild(excerpt);

                            const readMore = document.createElement('a');
                            readMore.className = 'blog-link';
                            readMore.href = safePostUrl;
                            if (isExternal) {
                                readMore.target = '_blank';
                                readMore.rel = 'noopener';
                            }
                            readMore.textContent = linkText;
                            content.appendChild(readMore);

                            article.appendChild(content);
                            blogList.appendChild(article);

                        });
                    }

                    renderPosts();

                    // Filter-Klick-Handler
                    filtersContainer.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            filtersContainer.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                            this.classList.add('active');
                            renderPosts(this.getAttribute('data-filter'));
                        });
                    });
                })
                .catch(err => console.error('Fehler beim Laden der Blog-Posts:', err));
        })();
    </script>
</body>
</html>
